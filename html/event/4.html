<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>长征传奇：灵活机动的战略战术（1935年1月—6月）</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../../css/ai-assistant.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        :root {
            --primary-red: #c62828;
            --secondary-red: #ef5350;
            --dark-bg: #0a0a14;
            --light-gray: #f5f5f5;
            --accent-gold: #ffb300;
            --mountain-blue: #1565c0;
            --river-blue: #0277bd;
            --snow-white: #e3f2fd;
            --transition-time: 0.4s;
        }
        
        body {
            background-color: var(--dark-bg);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* 动态背景 - 山川河流与战火 */
        .dynamic-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            overflow: hidden;
        }
        
        /* 深色山川背景 */
        .mountain-sky {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, #0a0a14 0%, #1a1a2e 20%, #1a2a3a 40%, #2a2a4a 70%, #1a0a0a 100%);
        }
        
        /* 移动的山脉轮廓 */
        .moving-mountains {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.3;
        }
        
        .mountain {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 300px;
            background: linear-gradient(to top, #1a1a2e 0%, transparent 100%);
            clip-path: polygon(0% 100%, 5% 80%, 10% 85%, 15% 70%, 20% 90%, 25% 75%, 30% 95%, 35% 65%, 40% 85%, 45% 60%, 50% 100%, 55% 70%, 60% 90%, 65% 55%, 70% 80%, 75% 50%, 80% 75%, 85% 45%, 90% 70%, 95% 40%, 100% 100%);
        }
        
        .mountain-2 {
            height: 250px;
            opacity: 0.5;
            background: linear-gradient(to top, #2a1a2e 0%, transparent 100%);
            clip-path: polygon(0% 100%, 10% 60%, 20% 80%, 30% 50%, 40% 70%, 50% 40%, 60% 65%, 70% 35%, 80% 60%, 90% 30%, 100% 100%);
            bottom: 50px;
            animation: mountainMove 120s linear infinite;
        }
        
        @keyframes mountainMove {
            0% { transform: translateX(0); }
            100% { transform: translateX(-100px); }
        }
        
        /* 河流效果 */
        .river-effect {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 150px;
            overflow: hidden;
        }
        
        .river-water {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to top, rgba(2, 119, 189, 0.3) 0%, rgba(21, 101, 192, 0.1) 100%);
        }
        
        .river-wave {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 20px;
            background: linear-gradient(90deg, transparent, rgba(33, 150, 243, 0.4), transparent);
            animation: riverWaveMove 8s linear infinite;
        }
        
        .river-wave:nth-child(2) {
            animation-delay: -2s;
            opacity: 0.6;
        }
        
        .river-wave:nth-child(3) {
            animation-delay: -4s;
            opacity: 0.3;
        }
        
        @keyframes riverWaveMove {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        /* 雪花效果 */
        .snow-effect {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        
        .snowflake {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: 50%;
            opacity: 0.7;
            filter: blur(1px);
        }
        
        /* 交互粒子效果 */
        .interactive-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }
        
        .particle {
            position: absolute;
            border-radius: 50%;
            pointer-events: none;
            opacity: 0;
        }
        
        /* 开始界面 */
        .start-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
            background-color: rgba(10, 10, 20, 0.95);
            z-index: 1000;
            transition: opacity 1s ease, visibility 1s ease;
        }
        
        .start-screen.hidden {
            opacity: 0;
            visibility: hidden;
        }
        
        .historical-badge {
            background: linear-gradient(135deg, var(--mountain-blue) 0%, #0d47a1 100%);
            color: white;
            padding: 12px 30px;
            border-radius: 30px;
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 40px;
            letter-spacing: 2px;
            border: 2px solid var(--accent-gold);
            box-shadow: 0 5px 20px rgba(13, 71, 161, 0.4);
            animation: badgePulse 3s infinite alternate;
        }
        
        @keyframes badgePulse {
            0% { transform: scale(1); box-shadow: 0 5px 20px rgba(13, 71, 161, 0.4); }
            100% { transform: scale(1.05); box-shadow: 0 8px 30px rgba(13, 71, 161, 0.6); }
        }
        
        .main-title {
            font-size: 3.5rem;
            margin-bottom: 25px;
            color: white;
            text-shadow: 0 5px 15px rgba(0, 0, 0, 0.7);
            line-height: 1.2;
        }
        
        .main-title span {
            color: var(--accent-gold);
            position: relative;
            display: inline-block;
        }
        
        .main-title span::after {
            content: "";
            position: absolute;
            bottom: 5px;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: var(--accent-gold);
            animation: underline 3s infinite alternate;
        }
        
        @keyframes underline {
            0% { width: 0%; left: 0; }
            50% { width: 100%; left: 0; }
            100% { width: 0%; left: 100%; }
        }
        
        .subtitle {
            font-size: 1.4rem;
            margin-bottom: 30px;
            color: #b0bec5;
            max-width: 900px;
            line-height: 1.6;
            font-weight: 300;
        }
        
        .start-button {
            background: linear-gradient(135deg, var(--mountain-blue) 0%, #0d47a1 100%);
            color: white;
            border: none;
            padding: 18px 50px;
            font-size: 1.4rem;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            letter-spacing: 1px;
            box-shadow: 0 10px 30px rgba(13, 71, 161, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 40px;
            position: relative;
            overflow: hidden;
        }
        
        .start-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(13, 71, 161, 0.6);
        }
        
        .start-button i {
            margin-left: 15px;
            animation: arrowBounce 1.5s infinite;
        }
        
        @keyframes arrowBounce {
            0%, 100% { transform: translateX(0); }
            50% { transform: translateX(10px); }
        }
        
        /* 探索主界面 */
        .exploration-container {
            min-height: 100vh;
            padding: 20px;
            display: none;
            flex-direction: column;
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            opacity: 0;
            transition: opacity 1s ease;
        }
        
        .exploration-container.active {
            display: flex;
            opacity: 1;
            animation: fadeIn 1s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* 时间定位器 */
        .time-locator {
            background-color: rgba(0, 0, 0, 0.7);
            padding: 20px 30px;
            border-radius: 15px;
            margin-bottom: 40px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-left: 5px solid var(--accent-gold);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.4);
            transform: translateY(-30px);
            opacity: 0;
            animation: slideIn 0.8s ease 0.2s forwards;
        }
        
        @keyframes slideIn {
            to { transform: translateY(0); opacity: 1; }
        }
        
        .time-period {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--accent-gold);
            display: flex;
            align-items: center;
        }
        
        .time-period i {
            margin-right: 15px;
            font-size: 2rem;
        }
        
        .location {
            font-size: 1.4rem;
            color: #bbdefb;
            display: flex;
            align-items: center;
        }
        
        .location i {
            margin-right: 10px;
        }
        
        /* 章节导航 */
        .chapter-navigation {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 50px;
        }
        
        .chapter-nav-item {
            background-color: rgba(30, 30, 40, 0.7);
            border-radius: 15px;
            padding: 25px;
            cursor: pointer;
            transition: all var(--transition-time) ease;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
            transform: translateY(30px);
            opacity: 0;
        }
        
        .chapter-nav-item.visible {
            animation: slideUp 0.6s ease forwards;
        }
        
        .chapter-nav-item:nth-child(1) { animation-delay: 0.3s; }
        .chapter-nav-item:nth-child(2) { animation-delay: 0.4s; }
        .chapter-nav-item:nth-child(3) { animation-delay: 0.5s; }
        .chapter-nav-item:nth-child(4) { animation-delay: 0.6s; }
        .chapter-nav-item:nth-child(5) { animation-delay: 0.7s; }
        
        @keyframes slideUp {
            to { transform: translateY(0); opacity: 1; }
        }
        
        .chapter-nav-item::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent, rgba(255, 179, 0, 0.05), transparent);
            opacity: 0;
            transition: opacity var(--transition-time) ease;
        }
        
        .chapter-nav-item:hover::before {
            opacity: 1;
        }
        
        .chapter-nav-item:hover {
            transform: translateY(-10px);
            border-color: var(--accent-gold);
            box-shadow: 0 15px 30px rgba(255, 179, 0, 0.15);
        }
        
        .chapter-nav-item.active {
            border-color: var(--accent-gold);
            background-color: rgba(30, 30, 40, 0.9);
            box-shadow: 0 10px 25px rgba(255, 179, 0, 0.2);
        }
        
        .chapter-nav-item.locked {
            cursor: not-allowed;
            opacity: 0.5;
            transform: none !important;
        }
        
        .chapter-nav-item.locked:hover {
            transform: none;
            border-color: transparent;
            box-shadow: none;
        }
        
        .chapter-icon {
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, var(--mountain-blue) 0%, #0d47a1 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            font-size: 1.8rem;
            color: white;
            position: relative;
            overflow: hidden;
        }
        
        .chapter-nav-item.active .chapter-icon {
            background: linear-gradient(135deg, var(--accent-gold) 0%, #ff8f00 100%);
        }
        
        .chapter-nav-item.completed .chapter-icon {
            background: linear-gradient(135deg, #2e7d32 0%, #1b5e20 100%);
        }
        
        .chapter-title {
            font-size: 1.6rem;
            margin-bottom: 10px;
            color: white;
        }
        
        .chapter-description {
            color: #b0bec5;
            font-size: 1rem;
            line-height: 1.5;
            margin-bottom: 15px;
        }
        
        .chapter-status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }
        
        .status-locked {
            background-color: rgba(85, 85, 85, 0.5);
            color: #aaa;
        }
        
        .status-available {
            background-color: rgba(33, 150, 243, 0.2);
            color: #64b5f6;
        }
        
        .status-completed {
            background-color: rgba(46, 125, 50, 0.2);
            color: #81c784;
        }
        
        /* 内容区域 */
        .content-area {
            flex-grow: 1;
            background-color: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            padding: 0;
            margin-bottom: 40px;
            overflow: hidden;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
            display: none;
            transform: translateY(30px);
            opacity: 0;
            transition: all 0.6s ease;
        }
        
        .content-area.active {
            display: block;
            transform: translateY(0);
            opacity: 1;
            animation: contentAppear 0.6s ease;
        }
        
        @keyframes contentAppear {
            0% { transform: translateY(30px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }
        
        .content-header {
            background: linear-gradient(135deg, var(--mountain-blue) 0%, #0d47a1 100%);
            padding: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .content-title {
            font-size: 2.2rem;
            color: white;
        }
        
        .content-subtitle {
            font-size: 1.2rem;
            color: rgba(255, 255, 255, 0.9);
            margin-top: 10px;
        }
        
        .close-content {
            background-color: rgba(255, 255, 255, 0.2);
            border: 2px solid white;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            transition: all 0.3s ease;
        }
        
        .close-content:hover {
            background-color: white;
            color: var(--mountain-blue);
            transform: rotate(90deg);
        }
        
        .content-body {
            padding: 40px;
            max-height: 70vh;
            overflow-y: auto;
        }
        
        /* 场景模拟 */
        .scene-simulation {
            background-color: rgba(0, 0, 0, 0.4);
            border-radius: 10px;
            padding: 30px;
            margin-bottom: 35px;
            border-left: 5px solid var(--accent-gold);
            position: relative;
            overflow: hidden;
        }
        
        .scene-simulation::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 0%, rgba(255, 179, 0, 0.05) 100%);
            z-index: 0;
        }
        
        .scene-title {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            color: var(--accent-gold);
            font-size: 1.5rem;
            position: relative;
            z-index: 1;
        }
        
        .scene-title i {
            margin-right: 15px;
            font-size: 1.8rem;
        }
        
        .scene-description {
            line-height: 1.8;
            font-size: 1.2rem;
            margin-bottom: 25px;
            position: relative;
            z-index: 1;
        }
        
        .scene-image {
            width: 100%;
            height: 250px;
            border-radius: 10px;
            margin: 20px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            background: linear-gradient(45deg, #1a1a2e, #16213e);
        }
        
        .scene-image::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, rgba(0, 0, 0, 0.7) 0%, rgba(0, 0, 0, 0.3) 100%);
        }
        
        .scene-image span {
            position: relative;
            z-index: 1;
            color: white;
            font-size: 1.3rem;
            text-align: center;
            padding: 20px;
        }
        
        /* 互动元素 */
        .interactive-element {
            background-color: rgba(13, 71, 161, 0.15);
            border-radius: 10px;
            padding: 30px;
            margin-bottom: 35px;
            border: 1px solid rgba(13, 71, 161, 0.3);
            position: relative;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.4s ease;
        }
        
        .interactive-element:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(13, 71, 161, 0.2);
            border-color: rgba(13, 71, 161, 0.6);
        }
        
        .interactive-element.disabled {
            cursor: default;
            opacity: 0.7;
            transform: none !important;
            box-shadow: none !important;
        }
        
        .interactive-title {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            color: #bbdefb;
            font-size: 1.4rem;
        }
        
        .interactive-title i {
            margin-right: 10px;
            font-size: 1.5rem;
        }
        
        .interactive-description {
            color: #e0e0e0;
            line-height: 1.6;
            font-size: 1.1rem;
        }
        
        /* 历史问答 */
        .historical-quiz {
            background-color: rgba(30, 30, 40, 0.6);
            border-radius: 10px;
            padding: 30px;
            margin-top: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: none;
            animation: fadeIn 0.8s ease;
        }
        
        .historical-quiz.visible {
            display: block;
        }
        
        .quiz-title {
            color: var(--accent-gold);
            font-size: 1.5rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }
        
        .quiz-title i {
            margin-right: 10px;
        }
        
        .quiz-question {
            margin-bottom: 25px;
            font-size: 1.2rem;
            line-height: 1.6;
            color: #e0e0e0;
        }
        
        .quiz-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .quiz-option {
            background-color: rgba(255, 255, 255, 0.1);
            border: 2px solid transparent;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .quiz-option:hover {
            background-color: rgba(255, 255, 255, 0.15);
            border-color: var(--accent-gold);
        }
        
        .quiz-option.selected {
            background-color: rgba(255, 179, 0, 0.2);
            border-color: var(--accent-gold);
        }
        
        .quiz-option.correct {
            background-color: rgba(46, 125, 50, 0.3);
            border-color: #2e7d32;
        }
        
        .quiz-option.incorrect {
            background-color: rgba(198, 40, 40, 0.3);
            border-color: var(--primary-red);
        }
        
        .quiz-feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            background-color: rgba(0, 0, 0, 0.3);
            border-left: 4px solid var(--accent-gold);
            display: none;
        }
        
        .quiz-feedback.visible {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        .quiz-next-btn {
            background: linear-gradient(135deg, var(--accent-gold) 0%, #ff8f00 100%);
            color: #333;
            border: none;
            padding: 12px 30px;
            border-radius: 30px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
            display: none;
        }
        
        .quiz-next-btn.visible {
            display: inline-block;
        }
        
        .quiz-next-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 179, 0, 0.3);
        }
        
        /* 历史档案 */
        .historical-dossier {
            background-color: rgba(30, 30, 40, 0.6);
            border-radius: 10px;
            padding: 30px;
            margin-top: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: none;
            animation: fadeIn 0.8s ease;
        }
        
        .historical-dossier.visible {
            display: block;
        }
        
        .dossier-title {
            color: var(--accent-gold);
            font-size: 1.5rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }
        
        .dossier-title i {
            margin-right: 10px;
        }
        
        .dossier-item {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .dossier-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .dossier-label {
            color: #bbdefb;
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }
        
        .dossier-value {
            color: #e0e0e0;
            line-height: 1.6;
            font-size: 1.1rem;
        }
        
        /* 阅读完成按钮 */
        .reading-complete-section {
            text-align: center;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: none;
        }
        
        .reading-complete-section.visible {
            display: block;
            animation: fadeIn 0.8s ease;
        }
        
        .complete-reading-btn {
            background: linear-gradient(135deg, var(--accent-gold) 0%, #ff8f00 100%);
            color: #333;
            border: none;
            padding: 15px 40px;
            border-radius: 30px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(255, 179, 0, 0.3);
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        .complete-reading-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(255, 179, 0, 0.4);
        }
        
        .complete-reading-btn i {
            margin-left: 10px;
        }
        
        /* 成就解锁 */
        .achievement-unlock {
            background: linear-gradient(135deg, rgba(255, 179, 0, 0.1) 0%, rgba(255, 179, 0, 0.2) 100%);
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            margin-top: 40px;
            border: 2px solid var(--accent-gold);
            display: none;
            animation: achievementAppear 0.8s ease;
        }
        
        .achievement-unlock.visible {
            display: block;
        }
        
        @keyframes achievementAppear {
            0% { transform: translateY(30px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }
        
        .achievement-icon {
            font-size: 3.5rem;
            color: var(--accent-gold);
            margin-bottom: 20px;
        }
        
        .achievement-title {
            font-size: 1.8rem;
            color: var(--accent-gold);
            margin-bottom: 10px;
        }
        
        .achievement-description {
            color: #e0e0e0;
            line-height: 1.5;
            font-size: 1.1rem;
            margin-bottom: 20px;
        }
        
        .continue-button {
            background-color: var(--accent-gold);
            color: #333;
            border: none;
            padding: 12px 30px;
            border-radius: 30px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1rem;
        }
        
        .continue-button:hover {
            background-color: #ffca28;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 179, 0, 0.3);
        }
        
        /* 响应式设计 */
        @media (max-width: 768px) {
            .main-title {
                font-size: 2.5rem;
            }
            
            .subtitle {
                font-size: 1.2rem;
            }
            
            .time-locator {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .time-period, .location {
                margin-bottom: 10px;
            }
            
            .chapter-navigation {
                grid-template-columns: 1fr;
            }
            
            .content-title {
                font-size: 1.8rem;
            }
            
            .content-body {
                padding: 25px;
                max-height: 60vh;
            }
            
            .quiz-options {
                grid-template-columns: 1fr;
            }
        }
        
        /* 自定义滚动条 */
        ::-webkit-scrollbar {
            width: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--mountain-blue);
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #0d47a1;
        }

        /* 视频播放器 */
        .video-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.95);
            z-index: 2000;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.8s ease;
        }

        .video-overlay.active {
            display: flex;
            opacity: 1;
            animation: fadeIn 0.8s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .video-container {
            width: 90%;
            max-width: 1000px;
            position: relative;
            transform: translateY(30px);
            opacity: 0;
            transition: all 0.8s ease 0.3s;
        }

        .video-overlay.active .video-container {
            transform: translateY(0);
            opacity: 1;
        }

        .video-container video {
            width: 100%;
            border-radius: 10px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.6);
        }

        .close-video {
            position: absolute;
            top: -60px;
            right: 0;
            background-color: var(--mountain-blue);
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .close-video:hover {
            transform: scale(1.1) rotate(90deg);
            background-color: #0d47a1;
        }

        .video-info {
            color: white;
            text-align: center;
            margin-top: 25px;
            max-width: 800px;
            font-size: 1.1rem;
            line-height: 1.6;
            opacity: 0.8;
        }
        /* 场景示意图 */
        .scene-image {
            margin-top: 14px;
            width: 100%;
            min-height: 220px;
            border-radius: 14px;
            border: 1px dashed rgba(255, 255, 255, 0.2);
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.02));
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            justify-content: flex-end;
            padding: 16px;
            position: relative;
            overflow: hidden;
        }
        .scene-image.has-image {
            border: none;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }
        .scene-image::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(180deg, transparent 40%, rgba(0, 0, 0, 0.35));
            pointer-events: none;
        }
        .scene-image-label {
            position: relative;
            font-weight: 600;
            color: #fff;
            z-index: 1;
            text-shadow: 0 2px 6px rgba(0, 0, 0, 0.35);
        }
        .scene-image-placeholder {
            position: relative;
            margin-top: 8px;
            padding: 10px 12px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.08);
            color: rgba(255, 255, 255, 0.85);
            z-index: 1;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <!-- 动态背景 - 山川河流与战火 -->
    <div class="dynamic-background">
        <div class="mountain-sky"></div>
        <div class="moving-mountains">
            <div class="mountain"></div>
            <div class="mountain mountain-2"></div>
        </div>
        <div class="river-effect">
            <div class="river-water"></div>
            <div class="river-wave"></div>
            <div class="river-wave"></div>
            <div class="river-wave"></div>
        </div>
        <!-- 雪花效果将通过JavaScript动态添加 -->
        <div id="snowEffect" class="snow-effect"></div>
    </div>
    
    <!-- 交互粒子效果 -->
    <div class="interactive-particles" id="interactiveParticles"></div>
    
    <!-- 开始界面 -->
    <div class="start-screen" id="startScreen">
        <div class="historical-badge">军事指挥艺术巅峰 #004</div>
        <h1 class="main-title">灵活机动的战略战术：<span>毛泽东的"神来之笔"</span></h1>
        <p class="subtitle">1935年1月至6月，遵义会议后重新获得军事指挥权的毛泽东，指挥仅剩3万余人的中央红军，在川黔滇边境的崇山峻岭中，上演了战争史上惊心动魄的篇章。</p>
        <p class="subtitle">从四渡赤水的谋略，到巧渡金沙江的果决，再到飞夺泸定桥的勇猛，最后是翻越雪山的坚韧——这是长征史诗中最富传奇色彩的华章。</p>
        <button class="start-button" id="startButton">
            开始探索 <i class="fas fa-mountain"></i>
        </button>
    </div>
    
    <!-- 视频播放器 -->
    <div class="video-overlay" id="videoOverlay">
        <div class="video-container">
            <button class="close-video" id="closeVideo">
                <i class="fas fa-times"></i>
            </button>
            <video id="historyVideo" controls>
                <source src="../../video/红军为什么要长征.mp4" type="video/mp4">
                您的浏览器不支持视频播放
            </video>
        </div>
        <div class="video-info">
            <p>观看本段视频以更好理解事件背景。观看结束后关闭播放器继续探索。</p>
        </div>
    </div>

    <!-- 探索主界面 -->
    <div class="exploration-container" id="explorationContainer">
        <!-- 时间定位器 -->
        <div class="time-locator">
            <div class="time-period">
                <i class="fas fa-calendar-alt"></i>
                <span>1935年1月—6月 · 遵义会议后</span>
            </div>
            <div class="location">
                <i class="fas fa-map-marker-alt"></i>
                <span>川黔滇边境 · 赤水河 · 大渡河 · 夹金山</span>
            </div>
        </div>
        
        <!-- 章节导航 -->
        <div class="chapter-navigation">
            <div class="chapter-nav-item visible active" data-chapter="1">
                <div class="chapter-icon">
                    <i class="fas fa-water"></i>
                </div>
                <h3 class="chapter-title">四渡赤水</h3>
                <p class="chapter-description">毛泽东军事生涯的"神来之笔"，在川黔滇边境四次穿越赤水河，迂回穿插，有效摆脱敌军围追堵截</p>
                <div class="chapter-status status-available">点击探索</div>
            </div>
            
            <div class="chapter-nav-item locked" data-chapter="2">
                <div class="chapter-icon">
                    <i class="fas fa-ship"></i>
                </div>
                <h3 class="chapter-title">巧渡金沙江</h3>
                <p class="chapter-description">跳出重围的关键一跃，仅靠7条木船昼夜渡江，摆脱数十万敌军追击</p>
                <div class="chapter-status status-locked">待解锁</div>
            </div>
            
            <div class="chapter-nav-item locked" data-chapter="3">
                <div class="chapter-icon">
                    <i class="fas fa-bridge"></i>
                </div>
                <h3 class="chapter-title">强渡大渡河与飞夺泸定桥</h3>
                <p class="chapter-description">打破"石达开覆辙"的预言，十七勇士强渡大渡河，二十二勇士飞夺泸定桥</p>
                <div class="chapter-status status-locked">待解锁</div>
            </div>
            
            <div class="chapter-nav-item locked" data-chapter="4">
                <div class="chapter-icon">
                    <i class="fas fa-mountain"></i>
                </div>
                <h3 class="chapter-title">翻越夹金山</h3>
                <p class="chapter-description">与自然极限的较量，红军克服极端严寒和缺氧，成功翻越长征途中第一座大雪山</p>
                <div class="chapter-status status-locked">待解锁</div>
            </div>
            
            <div class="chapter-nav-item locked" data-chapter="5">
                <div class="chapter-icon">
                    <i class="fas fa-users"></i>
                </div>
                <h3 class="chapter-title">总结与意义</h3>
                <p class="chapter-description">灵活机动战略战术的精髓，长征军事指挥艺术的巅峰</p>
                <div class="chapter-status status-locked">待解锁</div>
            </div>
        </div>
        
        <!-- 内容区域 -->
        <div class="content-area" id="contentArea">
            <div class="content-header">
                <div>
                    <h2 class="content-title" id="contentTitle">四渡赤水</h2>
                    <p class="content-subtitle" id="contentSubtitle">毛泽东军事生涯的"神来之笔"</p>
                </div>
                <button class="close-content" id="closeContent">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="content-body" id="contentBody">
                <!-- 内容将通过JavaScript动态加载 -->
            </div>
        </div>
        
        <!-- 成就解锁区域 -->
        <div id="achievementContainer"></div>
    </div>

    <script>
        // 探索章节数据
        const explorationData = {
            1: {
                title: "四渡赤水",
                subtitle: "毛泽东军事生涯的'神来之笔'",
                scene: {
                    title: "场景模拟：川黔滇边境的赤水河畔",
                    description: "1935年1月遵义会议后，蒋介石调集湘、川、滇、桂及中央军约40万兵力，从四面八方向仅剩3万余人的中央红军合围。毛泽东站在赤水河畔，凝视着地图上密集的敌军标志。身后是疲惫但坚定的红军战士，面前是湍急的赤水河。他知道，必须用高度机动的运动战，在敌人的包围圈中撕开一道口子……",
                    image: "../../img/四渡赤水.webp"
                },
                interactive: {
                    title: "点击探索：四渡赤水的战略精髓",
                    description: "点击此处，了解毛泽东如何通过四次穿越赤水河，牵着敌人的鼻子走，实现'在运动中歼灭敌人'的战争艺术。"
                },
                quiz: {
                    question: "四渡赤水战役中，毛泽东采用的核心战术是什么？",
                    options: [
                        { text: "阵地防御，坚守待援", correct: false },
                        { text: "高度机动的运动战，迂回穿插", correct: true },
                        { text: "集中优势兵力，正面突破", correct: false },
                        { text: "分散突围，各自为战", correct: false }
                    ],
                    feedback: "正确答案是'高度机动的运动战，迂回穿插'。四渡赤水是运动战的典范，通过反复穿越赤水河，调动敌人，使其疲于奔命，兵力分散，最终跳出包围圈。"
                },
                dossier: [
                    { label: "时间", value: "1935年1月29日至3月22日" },
                    { label: "地点", value: "贵州、四川、云南三省交界的赤水河流域" },
                    { label: "红军兵力", value: "约3万余人（遵义会议后）" },
                    { label: "敌军兵力", value: "蒋介石调集约40万兵力合围" },
                    { label: "一渡赤水", value: "1935年1月29日，原计划北渡长江受挫，西渡赤水进入川南" },
                    { label: "二渡赤水", value: "1935年2月18-21日，回师黔北，发动遵义战役，取得长征以来最大胜利" },
                    { label: "三渡赤水", value: "1935年3月16-17日，大张旗鼓进入川南，调动敌军" },
                    { label: "四渡赤水", value: "1935年3月21-22日，秘密折返，南下直插云南，跳出包围圈" },
                    { label: "战略意义", value: "被公认为毛泽东军事指挥艺术的巅峰之作，体现了'你打你的，我打我的'的主动作战思想" }
                ],
                achievement: {
                    title: "运动战大师",
                    description: "你已理解四渡赤水的战略精髓，掌握了毛泽东'走'与'打'完美结合的运动战艺术。",
                    nextChapter: 2
                }
            },
            2: {
                title: "巧渡金沙江",
                subtitle: "跳出重围的关键一跃",
                scene: {
                    title: "场景模拟：皎平渡的七个不眠夜",
                    description: "1935年5月，云南禄劝与四川会理交界的金沙江皎平渡。湍急的江水在峡谷中轰鸣，对岸是陡峭的悬崖。红军先遣队化装成国民党军，奇袭控制了渡口。全军仅靠搜获的7条木船，在37名当地船工帮助下，昼夜不停地摆渡。毛泽东、周恩来、朱德等领导人亲自组织渡江，每一分钟都关乎生死……",
                    image: "../../img/巧渡金沙江.webp"
                },
                interactive: {
                    title: "点击探索：巧渡金沙江的奇迹",
                    description: "点击此处，了解红军如何以少量部队吸引敌军，主力利用仅有的7条木船昼夜渡江，摆脱数十万敌军追击。"
                },
                quiz: {
                    question: "巧渡金沙江时，红军用了多少条船将3万余人全部渡过江？",
                    options: [
                        { text: "3条木船", correct: false },
                        { text: "7条木船", correct: true },
                        { text: "12条木船", correct: false },
                        { text: "架设浮桥渡江", correct: false }
                    ],
                    feedback: "正确答案是'7条木船'。红军在皎平渡仅靠搜获的7条木船，在37名船工帮助下，经过7天7夜连续摆渡，将3万余人全部渡过金沙江，未失一人一马。"
                },
                dossier: [
                    { label: "时间", value: "1935年5月3日至5月9日" },
                    { label: "地点", value: "金沙江皎平渡（四川会理与云南禄劝交界）" },
                    { label: "渡江方式", value: "仅靠7条木船昼夜摆渡" },
                    { label: "船工数量", value: "37名当地船工" },
                    { label: "渡江时间", value: "连续7天7夜" },
                    { label: "掩护部队", value: "红五军团在石板河一带顽强阻击尾追的国民党中央军" },
                    { label: "战略佯动", value: "佯攻昆明，调出滇军主力，导致金沙江沿岸防线空虚" },
                    { label: "历史意义", value: "至此，红军摆脱了自长征以来数十万敌军的围追堵截，取得了战略转移中具有决定意义的胜利" },
                    { label: "后续影响", value: "待国民党追兵赶到时，只看到废弃的草鞋，红军已远走高飞" }
                ],
                achievement: {
                    title: "战略突围专家",
                    description: "你已掌握巧渡金沙江的战术细节，理解了红军如何以智慧和勇气跳出敌人的重重包围。",
                    nextChapter: 3
                }
            },
            3: {
                title: "强渡大渡河与飞夺泸定桥",
                subtitle: "打破'石达开覆辙'的预言",
                scene: {
                    title: "场景模拟：大渡河上的生死较量",
                    description: "1935年5月，大渡河畔。蒋介石企图让红军重演太平天国翼王石达开在此全军覆没的历史。安顺场，红一团十七勇士在枪林弹雨中强渡大渡河；160公里外的泸定桥，二十二勇士攀着13根光溜溜的铁索向对岸冲击，脚下是奔腾咆哮的河水，对岸是敌人喷着火舌的碉堡……",
                    image: "../../img/飞夺泸定桥.webp"
                },
                interactive: {
                    title: "点击感受：飞夺泸定桥的英勇瞬间",
                    description: "点击此处，亲历红四团一昼夜奔袭240里，二十二勇士飞夺泸定桥的惊心动魄时刻。"
                },
                quiz: {
                    question: "飞夺泸定桥时，红军勇士面对的是怎样的桥面？",
                    options: [
                        { text: "完好的木板桥面", correct: false },
                        { text: "大部分木板被拆除，只剩13根铁索", correct: true },
                        { text: "石拱桥，但被炸毁了一半", correct: false },
                        { text: "简易浮桥，摇摇欲坠", correct: false }
                    ],
                    feedback: "正确答案是'大部分木板被拆除，只剩13根铁索'。守桥川军已将桥上木板大部拆除，红军二十二勇士在全团火力掩护下，攀着光溜溜的铁索向对岸冲击，创造了战争史上的奇迹。"
                },
                dossier: [
                    { label: "时间", value: "1935年5月25日（强渡大渡河），5月29日（飞夺泸定桥）" },
                    { label: "地点", value: "大渡河安顺场（今石棉县安顺场）和泸定桥" },
                    { label: "强渡部队", value: "红一军团一师一团，团长杨得志" },
                    { label: "突击队员", value: "十七勇士，由连长熊尚林带队" },
                    { label: "飞夺部队", value: "红一军团二师四团，团长王开湘，政委杨成武" },
                    { label: "奔袭距离", value: "一昼夜强行军240华里（约120公里）" },
                    { label: "泸定桥状况", value: "守军已将桥上木板大部拆除，只剩13根光溜溜的铁索" },
                    { label: "突击队员", value: "22名勇士（多为共产党员和积极分子）" },
                    { label: "战斗结果", value: "经过两小时激战，完全占领泸定城，打通北上的生死通道" },
                    { label: "历史意义", value: "打破了蒋介石让红军成为'石达开第二'的迷梦，'十七勇士'和'二十二勇士'成为长征英雄主义的永恒象征" }
                ],
                achievement: {
                    title: "英勇无畏的战士",
                    description: "你已亲历强渡大渡河与飞夺泸定桥的英勇战斗，感受到了红军战士大无畏的革命精神。",
                    nextChapter: 4
                }
            },
            4: {
                title: "翻越夹金山",
                subtitle: "与自然极限的较量",
                scene: {
                    title: "场景模拟：海拔4000米的生死考验",
                    description: "1935年6月，夹金山下。红军官兵大多穿着单衣、草鞋，望着眼前这座海拔4000多米、终年积雪的大雪山。山上空气稀薄，气候变化无常，时而晴空万里，时而冰雹大雪。宣传队员站在危险处鼓舞士气：'同志们，翻过雪山就是胜利！'体弱的战士相互搀扶，用刺刀在冰雪上凿出脚窝，一步一步向上攀登……",
                    image: "../../img/翻越雪山.webp"
                },
                interactive: {
                    title: "点击体验：翻越雪山的极端挑战",
                    description: "点击此处，感受红军在极端严寒和缺氧条件下，翻越长征途中第一座大雪山的艰难历程。"
                },
                quiz: {
                    question: "红军翻越夹金山时面临的主要困难是什么？",
                    options: [
                        { text: "敌军的空中轰炸", correct: false },
                        { text: "当地少数民族的抵抗", correct: false },
                        { text: "极端严寒、缺氧和衣不蔽体", correct: true },
                        { text: "迷路和缺乏地图", correct: false }
                    ],
                    feedback: "正确答案是'极端严寒、缺氧和衣不蔽体'。红军官兵大多穿着单衣、草鞋，缺乏御寒装备和食物，在空气稀薄、气候变化无常的雪山上，每前进一步都是对生理极限的挑战。"
                },
                dossier: [
                    { label: "时间", value: "1935年6月12日前后" },
                    { label: "地点", value: "夹金山（位于今四川宝兴县与懋功县之间）" },
                    { label: "海拔", value: "4000多米" },
                    { label: "气候特点", value: "空气稀薄，气候变化无常，时而晴空万里，时而冰雹大雪" },
                    { label: "红军装备", value: "大多穿着单衣、草鞋，缺乏御寒装备和食物" },
                    { label: "攀登方式", value: "用刺刀在冰雪上凿出脚窝，相互搀扶" },
                    { label: "宣传鼓动", value: "宣传队员站在危险处鼓舞士气" },
                    { label: "会师", value: "1935年6月12日，中央红军先头部队与前来接应的红四方面军一部在达维镇胜利会师" },
                    { label: "历史意义", value: "成功翻越长征中的第一座大雪山，不仅是对生理极限的挑战，更是对精神意志的磨砺，预示着红军面前没有不可逾越的障碍" }
                ],
                achievement: {
                    title: "雪山征服者",
                    description: "你已理解红军翻越夹金山的艰难，感受到了人类意志战胜自然极限的伟大力量。",
                    nextChapter: 5
                }
            },
            5: {
                title: "总结与意义",
                subtitle: "灵活机动战略战术的精髓",
                scene: {
                    title: "场景模拟：从被动到主动的战略转变",
                    description: "从1935年1月到6月，短短半年时间，中央红军在毛泽东的指挥下，彻底摆脱了'搬家式'转移的被动局面，转变为高度机动的'运动战'大师。四渡赤水的谋略，巧渡金沙江的果决，强渡大渡河、飞夺泸定桥的勇猛，翻越雪山的坚韧——这一系列行动淋漓尽致地展现了灵活机动的战略战术。",
                    image: "../../img/四渡总结.webp"
                },
                interactive: {
                    title: "点击总结：长征军事指挥艺术的巅峰",
                    description: "点击此处，全面总结遵义会议后红军灵活机动的战略战术，理解这一时期在长征史上的重要地位。"
                },
                quiz: {
                    question: "遵义会议后红军战略战术的最大转变是什么？",
                    options: [
                        { text: "从游击战转变为阵地战", correct: false },
                        { text: "从'搬家式'转移转变为高度机动的运动战", correct: true },
                        { text: "从集中兵力转变为分散行动", correct: false },
                        { text: "从主动进攻转变为被动防御", correct: false }
                    ],
                    feedback: "正确答案是'从'搬家式'转移转变为高度机动的运动战'。遵义会议后，毛泽东重新获得军事指挥权，红军彻底摆脱了笨重的'搬家式'转移，转变为高度机动的运动战，掌握了战场主动权。"
                },
                dossier: [
                    { label: "时间范围", value: "1935年1月（遵义会议）至1935年6月（翻越夹金山）" },
                    { label: "核心转变", value: "从被动转移转变为主动机动作战" },
                    { label: "指挥艺术", value: "毛泽东军事指挥艺术的集中体现，特别是四渡赤水被称为'神来之笔'" },
                    { label: "战术特点", value: "高度机动、迂回穿插、调动敌人、创造战机" },
                    { label: "精神体现", value: "坚定的革命意志、超凡的战斗精神、大无畏的英雄气概" },
                    { label: "关键战役", value: "四渡赤水、巧渡金沙江、强渡大渡河、飞夺泸定桥、翻越夹金山" },
                    { label: "战略成果", value: "摆脱数十万敌军围追堵截，实现与红四方面军的会师" },
                    { label: "历史评价", value: "长征史诗中最富传奇色彩的华章，世界军事史上的奇迹" },
                    { label: "现代启示", value: "灵活机动的战略战术、坚定的信念和意志力，至今仍有重要的启示意义" }
                ],
                achievement: {
                    title: "长征战略分析师",
                    description: "恭喜！你已完成'灵活机动的战略战术'全面探索，掌握了毛泽东军事指挥艺术的精髓，理解了这一时期在长征史上的重要地位。",
                    nextChapter: null
                }
            }
        };
        
        // 当前状态
        let currentChapter = 3;  // 全局节点ID
        let currentInternalChapter = 0;  // 内部章节ID
        let completedChapters = new Set();
        let achievementVisible = false;
        
        // DOM元素
        const startScreen = document.getElementById('startScreen');
        const startButton = document.getElementById('startButton');
        const explorationContainer = document.getElementById('explorationContainer');
        const chapterNavItems = document.querySelectorAll('.chapter-nav-item');
        const contentArea = document.getElementById('contentArea');
        const contentTitle = document.getElementById('contentTitle');
        const contentSubtitle = document.getElementById('contentSubtitle');
        const contentBody = document.getElementById('contentBody');
        const closeContent = document.getElementById('closeContent');
        const interactiveParticles = document.getElementById('interactiveParticles');
        const achievementContainer = document.getElementById('achievementContainer');
        const snowEffect = document.getElementById('snowEffect');
        // 视频元素（新增）
        const videoOverlay = document.getElementById('videoOverlay');
        const closeVideo = document.getElementById('closeVideo');
        const historyVideo = document.getElementById('historyVideo');
        
        // 初始化
        function init() {
            // 创建雪花效果
            createSnowflakes();
            
            // 事件监听
            startButton.addEventListener('click', startExploration);
            closeContent.addEventListener('click', closeContentArea);
            // 视频控制
            if (closeVideo) closeVideo.addEventListener('click', closeVideoPlayer);
            if (historyVideo) historyVideo.addEventListener('ended', function() {
                setTimeout(() => { closeVideoPlayer(); }, 1500);
            });
            
            // 章节导航点击事件
            chapterNavItems.forEach(item => {
                item.addEventListener('click', function() {
                    if (!this.classList.contains('locked')) {
                        const chapterId = parseInt(this.getAttribute('data-chapter'));
                        openChapter(chapterId);
                    }
                });
            });
            
            // 初始化第一个章节
            openChapter(1);
        }
        
        // 创建雪花效果
        function createSnowflakes() {
            for (let i = 0; i < 60; i++) {
                const snowflake = document.createElement('div');
                snowflake.className = 'snowflake';
                
                const size = Math.random() * 4 + 2;
                const startX = Math.random() * 100;
                const fallDuration = 10 + Math.random() * 20;
                const swayAmount = Math.random() * 100 - 50;
                const delay = Math.random() * 20;
                
                snowflake.style.width = `${size}px`;
                snowflake.style.height = `${size}px`;
                snowflake.style.left = `${startX}%`;
                snowflake.style.opacity = Math.random() * 0.5 + 0.3;
                
                // 雪花飘落动画
                const animation = snowflake.animate([
                    { 
                        transform: 'translate(0, -100px) rotate(0deg)',
                        opacity: 0 
                    },
                    { 
                        transform: `translate(${swayAmount}px, 100vh) rotate(${360 * 3}deg)`,
                        opacity: 0.7 
                    }
                ], {
                    duration: fallDuration * 1000,
                    delay: delay * 1000,
                    easing: 'linear',
                    iterations: Infinity
                });
                
                snowEffect.appendChild(snowflake);
            }
        }
        
        // 创建交互粒子效果
        function createInteractionEffect(x, y, color = '#ffb300', count = 8) {
            for (let i = 0; i < count; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                const size = Math.random() * 6 + 3;
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                particle.style.backgroundColor = color;
                particle.style.left = `${x}px`;
                particle.style.top = `${y}px`;
                
                const angle = Math.random() * Math.PI * 2;
                const distance = Math.random() * 60 + 30;
                const targetX = x + Math.cos(angle) * distance;
                const targetY = y + Math.sin(angle) * distance;
                
                interactiveParticles.appendChild(particle);
                
                const animation = particle.animate([
                    { 
                        transform: 'translate(0, 0) scale(1)', 
                        opacity: 1 
                    },
                    { 
                        transform: `translate(${targetX - x}px, ${targetY - y}px) scale(0)`, 
                        opacity: 0 
                    }
                ], {
                    duration: 500 + Math.random() * 300,
                    easing: 'cubic-bezier(0.215, 0.61, 0.355, 1)'
                });
                
                animation.onfinish = () => {
                    particle.remove();
                };
            }
        }
        
        // 开始探索（改为先展示视频）
        function startExploration() {
            const rect = startButton.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;

            createInteractionEffect(centerX, centerY, '#ffb300', 12);

            startScreen.classList.add('hidden');

            setTimeout(() => {
                if (videoOverlay && historyVideo) {
                    videoOverlay.classList.add('active');
                    try { historyVideo.play(); } catch(e) {}
                } else {
                    explorationContainer.classList.add('active');
                    chapterNavItems.forEach(item => item.classList.add('visible'));
                }
            }, 800);
        }

        // 关闭视频并进入探索界面
        function closeVideoPlayer() {
            const rect = closeVideo.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;

            createInteractionEffect(centerX, centerY, '#1565c0', 8);

            if (videoOverlay) videoOverlay.classList.remove('active');
            explorationContainer.classList.add('active');
            try { historyVideo.pause(); historyVideo.currentTime = 0; } catch(e) {}

            // 显示章节导航
            chapterNavItems.forEach(item => {
                item.classList.add('visible');
            });
        }
        
        // 打开章节
        function openChapter(chapterId) {
            // 如果当前有成就显示，先隐藏它
            if (achievementVisible) {
                hideAchievement();
            }
            
            currentInternalChapter = chapterId;  // 更新内部章节ID
            const chapterData = explorationData[chapterId];
            
            if (!chapterData) return;
            
            // 更新导航状态
            chapterNavItems.forEach(item => {
                const itemChapterId = parseInt(item.getAttribute('data-chapter'));
                item.classList.remove('active');
                
                if (itemChapterId === chapterId) {
                    item.classList.add('active');
                }
            });
            
            // 更新内容区域
            contentTitle.textContent = chapterData.title;
            contentSubtitle.textContent = chapterData.subtitle;
            
            // 构建内容
            const sceneImage = chapterData.scene && chapterData.scene.image;
            const hasImage = sceneImage && sceneImage.trim() !== '';
            let contentHTML = `
                <div class="scene-simulation">
                    <div class="scene-title">
                        <i class="fas fa-theater-masks"></i>
                        <span>${chapterData.scene.title}</span>
                    </div>
                    <p class="scene-description">${chapterData.scene.description}</p>
                    <div class="scene-image ${hasImage ? 'has-image' : 'no-image'}" ${hasImage ? `style="background-image: url('${sceneImage}')"` : ''}>
                        <div class="scene-image-label">历史场景示意图：${chapterData.title}</div>
                        ${hasImage ? '' : '<div class="scene-image-placeholder">暂未上传图片</div>'}
                    </div>
                </div>
            `;
            
            // 如果章节已完成，直接显示所有内容
            if (completedChapters.has(chapterId)) {
                contentHTML += `
                    <div class="interactive-element disabled">
                        <div class="interactive-title">
                            <i class="fas fa-search"></i>
                            <span>${chapterData.interactive.title}</span>
                        </div>
                        <p class="interactive-description">${chapterData.interactive.description}</p>
                    </div>
                    
                    <div class="historical-quiz visible">
                        <div class="quiz-title">
                            <i class="fas fa-question-circle"></i>
                            <span>历史问答</span>
                        </div>
                        <div class="quiz-question">${chapterData.quiz.question}</div>
                        <div class="quiz-options">
                `;
                
                chapterData.quiz.options.forEach((option, index) => {
                    const isCorrect = option.correct ? 'correct' : '';
                    contentHTML += `
                        <div class="quiz-option ${isCorrect}">
                            ${option.text}
                        </div>
                    `;
                });
                
                contentHTML += `
                        </div>
                        <div class="quiz-feedback visible">
                            ${chapterData.quiz.feedback}
                        </div>
                    </div>
                    
                    <div class="historical-dossier visible">
                        <div class="dossier-title">
                            <i class="fas fa-file-alt"></i>
                            <span>历史档案</span>
                        </div>
                `;
                
                chapterData.dossier.forEach(item => {
                    contentHTML += `
                        <div class="dossier-item">
                            <div class="dossier-label">${item.label}</div>
                            <div class="dossier-value">${item.value}</div>
                        </div>
                    `;
                });
                
                contentHTML += `</div>`;
                
                // 如果不是最后一章，显示继续探索按钮
                if (chapterData.achievement.nextChapter && !completedChapters.has(chapterData.achievement.nextChapter)) {
                    contentHTML += `
                        <div class="reading-complete-section visible">
                            <p style="margin-bottom: 20px; color: #b0bec5; font-size: 1.1rem;">本章节已完成，你可以继续探索下一章</p>
                            <button class="complete-reading-btn" onclick="continueToNextChapter(${chapterId})">
                                继续探索下一章 <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    `;
                }
            } else {
                // 章节未完成，显示可交互内容
                contentHTML += `
                    <div class="interactive-element" id="interactiveElement">
                        <div class="interactive-title">
                            <i class="fas fa-search"></i>
                            <span>${chapterData.interactive.title}</span>
                        </div>
                        <p class="interactive-description">${chapterData.interactive.description}</p>
                    </div>
                    
                    <div class="historical-quiz" id="historicalQuiz">
                        <!-- 历史问答将通过JavaScript动态加载 -->
                    </div>
                    
                    <div class="historical-dossier" id="historicalDossier">
                        <!-- 历史档案将通过JavaScript动态加载 -->
                    </div>
                    
                    <div class="reading-complete-section" id="readingCompleteSection">
                        <!-- 阅读完成按钮将通过JavaScript动态加载 -->
                    </div>
                `;
            }
            
            // 更新内容区域
            contentBody.innerHTML = contentHTML;
            contentArea.classList.add('active');
            
            // 如果章节未完成，设置交互事件
            if (!completedChapters.has(chapterId)) {
                const interactiveElement = document.getElementById('interactiveElement');
                interactiveElement.addEventListener('click', function(e) {
                    // 创建交互特效
                    createInteractionEffect(e.clientX, e.clientY, '#ffb300', 10);
                    
                    // 显示历史问答
                    const quizElement = document.getElementById('historicalQuiz');
                    let quizHTML = `
                        <div class="quiz-title">
                            <i class="fas fa-question-circle"></i>
                            <span>历史问答</span>
                        </div>
                        <div class="quiz-question">${chapterData.quiz.question}</div>
                        <div class="quiz-options" id="quizOptions">
                    `;
                    
                    chapterData.quiz.options.forEach((option, index) => {
                        quizHTML += `
                            <div class="quiz-option" data-index="${index}" data-correct="${option.correct}">
                                ${option.text}
                            </div>
                        `;
                    });
                    
                    quizHTML += `
                        </div>
                        <div class="quiz-feedback" id="quizFeedback">
                            ${chapterData.quiz.feedback}
                        </div>
                        <button class="quiz-next-btn" id="quizNextBtn">继续查看历史档案</button>
                    `;
                    
                    quizElement.innerHTML = quizHTML;
                    quizElement.classList.add('visible');
                    
                    // 禁用交互元素
                    interactiveElement.classList.add('disabled');
                    interactiveElement.style.cursor = 'default';
                    
                    // 设置问答选项点击事件
                    const quizOptions = document.querySelectorAll('.quiz-option');
                    quizOptions.forEach(option => {
                        option.addEventListener('click', function() {
                            // 移除所有选项的选中状态
                            quizOptions.forEach(opt => {
                                opt.classList.remove('selected');
                            });
                            
                            // 添加当前选项的选中状态
                            this.classList.add('selected');
                            
                            // 显示正确答案和错误答案的样式
                            const isCorrect = this.getAttribute('data-correct') === 'true';
                            if (isCorrect) {
                                this.classList.add('correct');
                            } else {
                                this.classList.add('incorrect');
                                
                                // 同时显示正确答案
                                quizOptions.forEach(opt => {
                                    if (opt.getAttribute('data-correct') === 'true') {
                                        opt.classList.add('correct');
                                    }
                                });
                            }
                            
                            // 显示反馈
                            const quizFeedback = document.getElementById('quizFeedback');
                            quizFeedback.classList.add('visible');
                            
                            // 显示继续按钮
                            const quizNextBtn = document.getElementById('quizNextBtn');
                            quizNextBtn.classList.add('visible');
                            
                            // 自动滚动到反馈区域
                            setTimeout(() => {
                                quizFeedback.scrollIntoView({ behavior: 'smooth', block: 'center' });
                            }, 300);
                        });
                    });
                    
                    // 设置继续按钮点击事件
                    const quizNextBtn = document.getElementById('quizNextBtn');
                    quizNextBtn.addEventListener('click', function() {
                        // 显示历史档案
                        const dossierElement = document.getElementById('historicalDossier');
                        let dossierHTML = `
                            <div class="dossier-title">
                                <i class="fas fa-file-alt"></i>
                                <span>历史档案</span>
                            </div>
                        `;
                        
                        chapterData.dossier.forEach(item => {
                            dossierHTML += `
                                <div class="dossier-item">
                                    <div class="dossier-label">${item.label}</div>
                                    <div class="dossier-value">${item.value}</div>
                                </div>
                            `;
                        });
                        
                        dossierElement.innerHTML = dossierHTML;
                        dossierElement.classList.add('visible');
                        
                        // 显示阅读完成按钮
                        const readingCompleteSection = document.getElementById('readingCompleteSection');
                        readingCompleteSection.innerHTML = `
                            <p style="margin-bottom: 20px; color: #b0bec5; font-size: 1.1rem;">你已经阅读完本章节内容，确认完成后可以解锁下一章</p>
                            <button class="complete-reading-btn" onclick="completeChapter(${chapterId})">
                                确认完成本章节 <i class="fas fa-check-circle"></i>
                            </button>
                        `;
                        readingCompleteSection.classList.add('visible');
                        
                        // 自动滚动到阅读完成按钮
                        setTimeout(() => {
                            readingCompleteSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        }, 300);
                    });
                    
                    // 自动滚动到问答区域
                    setTimeout(() => {
                        quizElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }, 300);
                });
            }
        }
        
        // 完成章节
        function completeChapter(chapterId) {
            const chapterData = explorationData[chapterId];
            
            // 标记章节为已完成
            completedChapters.add(chapterId);
            
            // 更新章节导航状态
            const currentNavItem = document.querySelector(`.chapter-nav-item[data-chapter="${chapterId}"]`);
            if (currentNavItem) {
                currentNavItem.classList.add('completed');
                const statusEl = currentNavItem.querySelector('.chapter-status');
                if (statusEl) {
                    statusEl.textContent = '已完成';
                    statusEl.className = 'chapter-status status-completed';
                }
            }
            
            // 解锁下一章
            if (chapterData.achievement.nextChapter) {
                unlockNextChapter(chapterData.achievement.nextChapter);
            }
            
            // 显示成就
            showAchievement(chapterData.achievement);
            
            // 创建完成特效
            const completeBtn = event.target.closest('.complete-reading-btn');
            if (completeBtn) {
                const rect = completeBtn.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;
                createInteractionEffect(centerX, centerY, '#2e7d32', 15);
            }
        }
        
        // 继续到下一章
        function continueToNextChapter(chapterId) {
            const chapterData = explorationData[chapterId];
            
            if (chapterData.achievement.nextChapter) {
                // 隐藏当前内容区域
                contentArea.classList.remove('active');
                
                // 打开下一章
                setTimeout(() => {
                    openChapter(chapterData.achievement.nextChapter);
                }, 300);
                
                // 创建过渡特效
                const continueBtn = event.target.closest('.complete-reading-btn');
                if (continueBtn) {
                    const rect = continueBtn.getBoundingClientRect();
                    const centerX = rect.left + rect.width / 2;
                    const centerY = rect.top + rect.height / 2;
                    createInteractionEffect(centerX, centerY, '#ffb300', 12);
                }
            }
        }
        
        // 解锁下一章
        function unlockNextChapter(nextChapterId) {
            const nextChapterItem = document.querySelector(`.chapter-nav-item[data-chapter="${nextChapterId}"]`);
            if (nextChapterItem) {
                nextChapterItem.classList.remove('locked');
                nextChapterItem.classList.add('visible');
                nextChapterItem.style.cursor = 'pointer';
                
                const statusEl = nextChapterItem.querySelector('.chapter-status');
                if (statusEl) {
                    statusEl.textContent = '点击探索';
                    statusEl.className = 'chapter-status status-available';
                }
                
                // 添加解锁特效
                const iconEl = nextChapterItem.querySelector('.chapter-icon');
                const rect = iconEl.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;
                createInteractionEffect(centerX, centerY, '#ffb300', 10);
            }
        }
        
        // 关闭内容区域
        function closeContentArea() {
            const rect = closeContent.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            
            createInteractionEffect(centerX, centerY, '#c62828', 8);
            
            contentArea.classList.remove('active');
            
            // 如果成就显示中，也隐藏它
            if (achievementVisible) {
                hideAchievement();
            }
        }
        
        // 显示成就
        function showAchievement(achievement) {
            achievementVisible = true;
            
            const achievementHTML = `
                <div class="achievement-unlock visible">
                    <div class="achievement-icon">
                        <i class="fas fa-medal"></i>
                    </div>
                    <h3 class="achievement-title">${achievement.title}</h3>
                    <p class="achievement-description">${achievement.description}</p>
                    ${achievement.nextChapter ? 
                        `<button class="continue-button" onclick="continueToNextChapter(${currentInternalChapter})">继续探索下一章</button>` : 
                        `<button class="continue-button" onclick="finishAndReturnToMap(${currentChapter})">返回地图</button>`
                    }
                </div>
            `;
            
            achievementContainer.innerHTML = achievementHTML;
            
            // 自动滚动到成就区域
            setTimeout(() => {
                const achievementEl = achievementContainer.querySelector('.achievement-unlock');
                if (achievementEl) {
                    achievementEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }, 300);
        }
        
        // 隐藏成就
        function hideAchievement() {
            achievementVisible = false;
            achievementContainer.innerHTML = '';
        }
        
        // 页面加载完成后初始化
        window.addEventListener('DOMContentLoaded', init);

        function finishAndReturnToMap(currentChapter){
            try{
                // 从URL获取模式，使用对应的localStorage键
                const urlParams = new URLSearchParams(window.location.search);
                const currentMode = urlParams.get('mode') || 'linear';
                const KEY = currentMode === 'free' ? 'lm_unlocks_free_v1' : 'lm_unlocks_linear_v1';
                const raw = localStorage.getItem(KEY);
                const st = raw ? JSON.parse(raw) : { mode:currentMode, unlocked: Array(8).fill(false), unlockedIndex:0 };
                if(!st.unlocked[currentChapter]) st.unlocked[currentChapter] = true;
                if(currentMode === 'linear' || st.mode === 'linear'){
                    const next = Math.min(7, currentChapter+1);
                    st.unlocked[next] = true;
                    st.unlockedIndex = Math.max(st.unlockedIndex||0, next);
                }
                st.mode = currentMode;
                localStorage.setItem(KEY, JSON.stringify(st));
                window.location.href = '../map.html?mode=' + currentMode;
            }catch(e){
                const urlParams = new URLSearchParams(window.location.search);
                const currentMode = urlParams.get('mode') || 'linear';
                window.location.href = '../map.html?mode=' + currentMode;
            }
        }

        // 使函数在全局可用
        window.openChapter = openChapter;
        window.completeChapter = completeChapter;
        window.continueToNextChapter = continueToNextChapter;
        window.finishAndReturnToMap = finishAndReturnToMap;
    </script>


    <!-- AI助手按钮 -->
<button id="aiAssistantButton" title="AI助手">
  <span>🤖</span>
</button>

<!-- AI对话窗口 -->
<div id="aiChatWindow">
  <div class="chat-header">
    <h3>长征小助手</h3>
    <button id="closeChat">×</button>
  </div>
  <div id="chatMessages"></div>
  <div class="chat-input-area">
    <textarea id="userInput" placeholder="输入你的问题... (Enter发送，Shift+Enter换行)" rows="2"></textarea>
    <button id="sendButton">发送</button>
  </div>
  <div id="loadingIndicator" style="display: none;">思考中...</div>
</div>

<script src="../../js/ai-assistant.js"></script>
</body>
</html>
